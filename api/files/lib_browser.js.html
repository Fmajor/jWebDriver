<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib\browser.js - jWebDriver API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="https:&#x2F;&#x2F;raw.github.com&#x2F;yaniswang&#x2F;jWebDriver&#x2F;master&#x2F;logo_s.png" title="jWebDriver API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.9.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Browser.html">Browser</a></li>
            
                <li><a href="..&#x2F;classes/Element.html">Element</a></li>
            
                <li><a href="..&#x2F;classes/JWebDriver.html">JWebDriver</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib\browser.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
* This class is used for control browser.
* &lt;p&gt;
* Browser类用来实例化一个对象，以绑定目标浏览器并调用接口进行控制。
* &lt;&#x2F;p&gt;
* @class Browser
*&#x2F;

var http = require(&#x27;http&#x27;),
	fs = require(&#x27;fs&#x27;),
	Fiber = require(&#x27;fibers&#x27;),
	extend = require(&#x27;xtend&#x27;);

var Element = require(&#x27;.&#x2F;element&#x27;);

var arrCommands = require(&#x27;.&#x2F;commands.js&#x27;);

&#x2F;&#x2F;颜色列表
var colors = {
	black: &#x27;\x1b[0;30m&#x27;,
	dkgray: &#x27;\x1b[1;30m&#x27;,
	brick: &#x27;\x1b[0;31m&#x27;,
	red: &#x27;\x1b[1;31m&#x27;,
	green: &#x27;\x1b[0;32m&#x27;,
	lime: &#x27;\x1b[1;32m&#x27;,
	brown: &#x27;\x1b[0;33m&#x27;,
	yellow: &#x27;\x1b[1;33m&#x27;,
	navy: &#x27;\x1b[0;34m&#x27;,
	blue: &#x27;\x1b[1;34m&#x27;,
	violet: &#x27;\x1b[0;35m&#x27;,
	magenta: &#x27;\x1b[1;35m&#x27;,
	teal: &#x27;\x1b[0;36m&#x27;,
	cyan: &#x27;\x1b[1;36m&#x27;,
	ltgray: &#x27;\x1b[0;37m&#x27;,
	white: &#x27;\x1b[1;37m&#x27;,
	reset: &#x27;\x1b[0m&#x27;
};

&#x2F;&#x2F;响应代码
var responseCodes = {
	&#x27;0&#x27;: {type: &#x27;Success&#x27;, message:	&#x27;The command executed successfully.&#x27;},
	&#x27;7&#x27;: {type: &#x27;NoSuchElement&#x27;, message: &#x27;An element could not be located on the page using the given search parameters.&#x27;},
	&#x27;8&#x27;: {type: &#x27;NoSuchFrame&#x27;, message: &#x27;A request to switch to a frame could not be satisfied because the frame could not be found.&#x27;},
	&#x27;9&#x27;: {type: &#x27;UnknownCommand&#x27;, message: &#x27;The requested resource could not be found, or a request was received using an HTTP method that is not supported by the mapped resource.&#x27;},
	&#x27;10&#x27;: {type: &#x27;StaleElementReference&#x27;, message: &#x27;An element command failed because the referenced element is no longer attached to the DOM.&#x27;},
	&#x27;11&#x27;: {type: &#x27;ElementNotVisible&#x27;, message: &#x27;An element command could not be completed because the element is not visible on the page.&#x27;},
	&#x27;12&#x27;: {type: &#x27;InvalidElementState&#x27;, message: &#x27;An element command could not be completed because the element is in an invalid state (e.g. attempting to click a disabled element).&#x27;},
	&#x27;13&#x27;: {type: &#x27;UnknownError&#x27;, message: &#x27;An unknown server-side error occurred while processing the command.&#x27;},
	&#x27;15&#x27;: {type: &#x27;ElementIsNotSelectable&#x27;, message: &#x27;An attempt was made to select an element that cannot be selected.&#x27;},
	&#x27;17&#x27;: {type: &#x27;JavaScriptError&#x27;, message: &#x27;An error occurred while executing user supplied JavaScript.&#x27;},
	&#x27;19&#x27;: {type: &#x27;XPathLookupError&#x27;, message: &#x27;An error occurred while searching for an element by XPath.&#x27;},
	&#x27;23&#x27;: {type: &#x27;NoSuchWindow&#x27;, message: &#x27;A request to switch to a different window could not be satisfied because the window could not be found.&#x27;},
	&#x27;24&#x27;: {type: &#x27;InvalidCookieDomain&#x27;, message: &#x27;An illegal attempt was made to set a cookie under a different domain than the current page.&#x27;},
	&#x27;25&#x27;: {type: &#x27;UnableToSetCookie&#x27;, message: &#x27;A request to set a cookie\&#x27;s value could not be satisfied.&#x27;},
    &#x27;26&#x27;: {type: &#x27;UnexpectedAlertOpen&#x27;, message: &#x27;A modal dia&#x60; was open, blocking this operation&#x27;},
    &#x27;27&#x27;: {type: &#x27;NoAlertOpenError&#x27;, message: &#x27;An attempt was made to operate on a modal dialog when one was not open.&#x27;},
	&#x27;28&#x27;: {type: &#x27;ScriptTimeout&#x27;, message: &#x27;A script did not complete before its timeout expired.&#x27;},
    &#x27;29&#x27;: {type: &#x27;InvalidElementCoordinates&#x27;, message: &#x27;The coordinates provided to an interactions operation are invalid.&#x27;},
    &#x27;30&#x27;: {type: &#x27;IMENotAvailable&#x27;, message: &#x27;IME was not available.&#x27;},
    &#x27;31&#x27;: {type : &#x27;IMEEngineActivationFailed&#x27;, message: &#x27;An IME engine could not be started.&#x27;},
    &#x27;32&#x27;: {type: &#x27;InvalidSelector&#x27;, message: &#x27;Argument was an invalid selector (e.g. XPath&#x2F;CSS).&#x27;}
};

&#x2F;&#x2F;默认浏览器参数
var defaultOptions = {
	&#x27;browserName&#x27;: &#x27;firefox&#x27;,
	&#x27;version&#x27;: &#x27;&#x27;,
	&#x27;platform&#x27;: &#x27;ANY&#x27;,
	&#x27;javascriptEnabled&#x27;: true,
	&#x27;proxy&#x27;: {
		&#x27;proxyType&#x27;: &#x27;direct&#x27;
	}
}

&#x2F;&#x2F;浏览器昵称
var arrBrowserNickName = {
	&#x27;ie&#x27;: &#x27;internet explorer&#x27;,
	&#x27;ff&#x27;: &#x27;firefox&#x27;
}

&#x2F;&#x2F;鼠标按钮映射表
var arrMouseButton = {
	&#x27;left&#x27;: 0,
	&#x27;middle&#x27;: 1,
	&#x27;right&#x27;: 2
}

&#x2F;&#x2F;键盘特殊按键映射表
var arrSpecKeys = {
	&#x27;null&#x27;: &#x27;\uE000&#x27;,
	&#x27;cancel&#x27;: &#x27;\uE001&#x27;,
	&#x27;help&#x27;: &#x27;\uE002&#x27;,
	&#x27;back&#x27;: &#x27;\uE003&#x27;,
	&#x27;tab&#x27;: &#x27;\uE004&#x27;,
	&#x27;clear&#x27;: &#x27;\uE005&#x27;,
	&#x27;return&#x27;: &#x27;\uE006&#x27;,
	&#x27;enter&#x27;: &#x27;\uE007&#x27;,
	&#x27;shift&#x27;: &#x27;\uE008&#x27;,
	&#x27;ctrl&#x27;: &#x27;\uE009&#x27;,
	&#x27;alt&#x27;: &#x27;\uE00A&#x27;,
	&#x27;pause&#x27;: &#x27;\uE00B&#x27;,
	&#x27;esc&#x27;: &#x27;\uE00C&#x27;,
	&#x27;space&#x27;: &#x27;\uE00D&#x27;,
	&#x27;pageup&#x27;: &#x27;\uE00E&#x27;,
	&#x27;pagedown&#x27;: &#x27;\uE00F&#x27;,
	&#x27;end&#x27;: &#x27;\uE010&#x27;,
	&#x27;home&#x27;: &#x27;\uE011&#x27;,
	&#x27;left&#x27;: &#x27;\uE012&#x27;,
	&#x27;up&#x27;: &#x27;\uE013&#x27;,
	&#x27;right&#x27;: &#x27;\uE014&#x27;,
	&#x27;down&#x27;: &#x27;\uE015&#x27;,
	&#x27;insert&#x27;: &#x27;\uE016&#x27;,
	&#x27;delete&#x27;: &#x27;\uE017&#x27;,
	&#x27;semicolon&#x27;: &#x27;\uE018&#x27;,
	&#x27;equals&#x27;: &#x27;\uE019&#x27;,
	&#x27;num0&#x27;: &#x27;\uE01A&#x27;,
	&#x27;num1&#x27;: &#x27;\uE01B&#x27;,
	&#x27;num2&#x27;: &#x27;\uE01C&#x27;,
	&#x27;num3&#x27;: &#x27;\uE01D&#x27;,
	&#x27;num4&#x27;: &#x27;\uE01E&#x27;,
	&#x27;num5&#x27;: &#x27;\uE01F&#x27;,
	&#x27;num6&#x27;: &#x27;\uE020&#x27;,
	&#x27;num7&#x27;: &#x27;\uE021&#x27;,
	&#x27;num8&#x27;: &#x27;\uE022&#x27;,
	&#x27;num9&#x27;: &#x27;\uE023&#x27;,
	&#x27;multiply&#x27;: &#x27;\uE024&#x27;,
	&#x27;add&#x27;: &#x27;\uE025&#x27;,
	&#x27;separator&#x27;: &#x27;\uE026&#x27;,
	&#x27;subtract&#x27;: &#x27;\uE027&#x27;,
	&#x27;decimal&#x27;: &#x27;\uE028&#x27;,
	&#x27;divide&#x27;: &#x27;\uE029&#x27;,
	&#x27;f1&#x27;: &#x27;\uE031&#x27;,
	&#x27;f2&#x27;: &#x27;\uE032&#x27;,
	&#x27;f3&#x27;: &#x27;\uE033&#x27;,
	&#x27;f4&#x27;: &#x27;\uE034&#x27;,
	&#x27;f5&#x27;: &#x27;\uE035&#x27;,
	&#x27;f6&#x27;: &#x27;\uE036&#x27;,
	&#x27;f7&#x27;: &#x27;\uE037&#x27;,
	&#x27;f8&#x27;: &#x27;\uE038&#x27;,
	&#x27;f9&#x27;: &#x27;\uE039&#x27;,
	&#x27;f10&#x27;: &#x27;\uE03A&#x27;,
	&#x27;f11&#x27;: &#x27;\uE03B&#x27;,
	&#x27;f12&#x27;: &#x27;\uE03C&#x27;,
	&#x27;command&#x27;: &#x27;\uE03D&#x27;,
	&#x27;meta&#x27;: &#x27;\uE03D&#x27;
}

var Browser = function(){
	var self = this;
	return self._init.apply(self, arguments);
}

Browser.prototype = {

	&#x2F;**
	 * 初始化浏览器对象
	 * @method _init
	 * @private
	 * @param  {Object} config jWebDriver config
	 * @param  {Object}   options  浏览器初始化参数
	 * @param  {Function} callback 回调函数
	 *&#x2F;
	_init: function(config, options, callback){
		var self = this;
		self.sessionId = null;
		self.logMode = config.logMode;
		self.host = config.host;
		self.port = config.port;
		var browserName = options.browserName;
		if(browserName &amp;&amp; (browserName = arrBrowserNickName[browserName])){
			options.browserName = browserName;
		}
		var sessionOptions = {
			&#x27;desiredCapabilities&#x27;: extend({}, defaultOptions, options)
		};
		self.doCommand(&#x27;setSession&#x27;, sessionOptions, callback);
		self.windowHandle = &#x27;current&#x27;;
	},

	&#x2F;**
	 * 输出日志
	 * @method log
	 * @public
	 * @param  {String} type 日志类型
	 * @param  {String} message 日志内容
	 * @return {Browser}	当前Browser对象实例
	 *&#x2F;
	log: function(type, message){
		var self = this;
		if(message === undefined){
			message = type;
			type = &#x27;INFO&#x27;;
		}
		if(self.logMode === &#x27;all&#x27; || (self.logMode === &#x27;error&#x27; &amp;&amp; type === &#x27;ERROR&#x27;)){
			var dateString = (new Date()).toString().match(&#x2F;\d\d:\d\d:\d\d&#x2F;)[0];
			var mapColors = {
				&#x27;COMMAND&#x27;: colors.violet,
				&#x27;DATA&#x27;: colors.brown,
				&#x27;RESULT&#x27;: colors.teal,
				&#x27;ERROR&#x27;: colors.red,
				&#x27;WARNING&#x27;: colors.yellow,
				&#x27;INFO&#x27;: colors.white
			}
			if(message){
				console.log(colors.dkgray +&#x27;[&#x27; + dateString + &#x27;]: &#x27; + colors.reset, mapColors[type] + type + colors.reset, &#x27;\t&#x27;, message);
			}
			else{
				console.log(colors.dkgray +&#x27;[&#x27; + dateString + &#x27;]: &#x27; + colors.reset, mapColors[type] + type + colors.reset);
			}
		}
		return self;
	},

	&#x2F;**
	 * 检查返回值是否有错误，适用于所有WebDriver API的返回值
	 * @method isError
	 * @public
	 * @param  {Object}  result 所有WebDriver API的返回值
	 * @return {Boolean}        如果有错误返回true
	 *&#x2F;
	isError: function(result){
		var status = result.status;
		return status !== undefined &amp;&amp; status !== 0;
	},

	&#x2F;**
	 * 检查返回值是否正确，适用于所有WebDriver API的返回值
	 * @method isOk
	 * @public
	 * @param  {Object}  result 所有WebDriver API的返回值
	 * @return {Boolean}        如果正确返回true
	 *&#x2F;
	isOk: function(result){
		return !this.isError(result);
	},

	&#x2F;**
	 * 执行webdriver命令
	 * @method doCommand
	 * @public
	 * @param  {String}   cmd      命令名称
	 * @param  {Object}   data     命令数据
	 * @param  {Function} [callback] 回调函数，如果省略此参数，则为同步模式，直接返回结果
	 * @return {Object}            webdriver返回的JSON对象
	 *&#x2F;
	doCommand: function(cmd, data, callback){
		var self = this, cmdInfo = arrCommands[cmd];
		if(cmdInfo){
			var method = cmdInfo[0], path = cmdInfo[1];
			path = path.replace(&#x27;:sessionId&#x27;, self.sessionId);
			var pathValues;
			if(data &amp;&amp; (pathValues = data.pathValues)){
				&#x2F;&#x2F;填充PATH中除sessionId以外的参数
				for(var name in pathValues){
					path = path.replace(&#x27;:&#x27;+name, encodeURIComponent(pathValues[name]));
				}
				delete data.pathValues;
			}
			var requestOptions = {
				&#x27;method&#x27;: method,
				&#x27;host&#x27;: self.host,
				&#x27;port&#x27;: self.port,
				&#x27;path&#x27;: &#x27;&#x2F;wd&#x2F;hub&#x27;+path
		    };

			function getResult(result){
				if(result){
					result = result.replace(&#x2F;\x00&#x2F;g,&#x27;&#x27;)
					try{
						result = JSON.parse(result);
					}
					catch(err){
		                if (result !== &#x27;&#x27;) {
		                	self.log(&#x27;ERROR&#x27;, err + &#x27;\n&#x27; + result + &#x27;\n&#x27;)
		                }
		                result = {status: -1, errorType: &#x27;jsonError&#x27;, errorMessage: &#x27;JSON.parse error.&#x27;};
		                return callback?callback(result):result;
					}

					if (result.status === 0) {&#x2F;&#x2F;操作成功
						self.log(&#x27;RESULT&#x27;, result.value);
						result = result.value;
					}
		            else {
			   			var responseInfo = responseCodes[result.status],
							responseType = responseInfo.type,
							responseMessage = responseInfo.message;

						result.errorType = responseType;
						result.errorMessage = responseMessage;

						self.log(&#x27;ERROR&#x27;, responseType);
		            }
				}
				if(callback){
					callback(result);
				}
				else{
					return result;
				}
			}
			if(callback){
				self._doRequest(requestOptions, data, getResult);
			}
			else{
				var response = self._doRequest(requestOptions, data);
				return getResult(response);
			}
		}
	},

	&#x2F;**
	 * 发起HTTP请求到webdriver的接口
	 * @method _doRequest
	 * @private
	 * @param  {Object}   requestOptions HTTP请求参数
	 * @param  {Object}   data           HTTP BODY
	 * @param  {Function} [callback]       回调函数，活力回调函数则为同步返回模式
	 * @return {String}                  HTTP响应字符串
	 *&#x2F;
	_doRequest: function(requestOptions, data, callback){
		var self = this, fiber = Fiber.current;

		self.log(&#x27;COMMAND&#x27;, requestOptions.method + &#x27;\t&#x27; + requestOptions.path);

		var responseStr = &#x27;&#x27;;

		if(data){
			data = JSON.stringify(data);
			&#x2F;&#x2F;转义Unicode字符
			data = data.replace(&#x2F;[^\x00-\xff]&#x2F;g, function(a){
				return &#x27;\\&#x27;+escape(a).substr(1);
			});
			if(data !== &#x27;{}&#x27;){
				self.log(&#x27;DATA&#x27;, data);
			}
		}
		else{
			data = &#x27;&#x27;;
		}
		requestOptions.headers = {
			&#x27;content-type&#x27;: &#x27;application&#x2F;json&#x27;,
			&#x27;charset&#x27;: &#x27;charset=UTF-8&#x27;,
			&#x27;content-length&#x27;: data.length
		}

		var req = http.request(requestOptions, function(res){
			var arrResBuffers = [], resBufferSize = 0;
		    res.on(&#x27;data&#x27;, function (data) {
		        arrResBuffers.push(data);
		        resBufferSize += data.length;
		    });
		    res.on(&#x27;end&#x27;, function () {
		        var resBuffer = new Buffer(resBufferSize), pos = 0;
		        for(var i = 0, c = arrResBuffers.length; i &lt; c; i++) {
		            arrResBuffers[i].copy(resBuffer, pos);
		            pos += arrResBuffers[i].length;
		        }
		        responseStr = resBuffer.toString(&#x27;utf-8&#x27;);
		        if(self.sessionId === null){
		        	try{
		        		var match = res.headers.location.match(&#x2F;wd\&#x2F;hub\&#x2F;session\&#x2F;(\d+)$&#x2F;i);
		        		if(match !== null){
		        			self.sessionId = match[1];
		        			self.log(&#x27;RESULT&#x27;, self.sessionId);
		        		}
		        	}
		        	catch(e){
		        	}
		        }
		        if(callback){&#x2F;&#x2F;异步模式
		        	callback(responseStr);
		        }
		        else if(fiber){&#x2F;&#x2F;同步模式
		        	fiber.run();
		        }
		     });
		});

		req.on(&#x27;error&#x27;, function(err)
		{
			self.log(&#x27;ERROR&#x27;, &#x27;ERROR ON REQUEST&#x27;);
		});

		if(data){
			req.write(data);
		}
		req.end();

		if(callback === undefined &amp;&amp; fiber){
			Fiber.yield();
			return responseStr;
		}
	},

	&#x2F;**
	 * 延迟一定时间
	 * @method sleep
	 * @public
	 * @param  {Number} ms 需要延迟的时间，单位毫秒
	 * @return {Browser}	当前Browser对象实例
	 *&#x2F;
	sleep: function(ms){
		var fiber = Fiber.current;
		setTimeout(function(){
			fiber.run();
		},ms);
		Fiber.yield();
		return this;
	},

	&#x2F;**
	 * 返回窗口句柄
	 * @method window
	 * @public
	 * @param  {Boolean} [bAll] 是否返回所有窗口，设置为true返回所有窗口
	 * @return {String|Array}       单个或数组形式的窗口句柄
	 *&#x2F;
	window: function(bAll){
		return this.doCommand(bAll === true?&#x27;getWindows&#x27;:&#x27;getWindow&#x27;);
	},

	&#x2F;**
	 * 切换到另一个Window或Frame
	 * @method switchTo
	 * @public
	 * @param  {String|Element|Number} [target] 要切换的目标窗口句柄、Frame对象(Element)、Frame在页面中的序号(Number)，如果省略此参数则切换到主窗口
	 * @return {Browser}	当前Browser对象实例
	 *&#x2F;
	switchTo: function(target){
		var self = this;
		if(typeof target === &#x27;string&#x27;){
			self.windowHandle = target;
			self.doCommand(&#x27;switchWindow&#x27;,{name: target});
		}
		else if(target instanceof Element){
			self.doCommand(&#x27;switchFrame&#x27;,{id: target.toArray()});
		}
		else if(target === undefined){
			self.doCommand(&#x27;switchFrame&#x27;,{id: null});
		}
		return self;
	},

	&#x2F;**
	 * 返回或者设置当前窗口的大小
	 * @method size
	 * @public
	 * @param  {Number|Object} [width]  宽度或者大小对象({width,height})
	 * @param  {Number} [height] 高度
	 * @return {Object|Browser}        如果无宽度和高度参数，则返回当前大小对象，否则返回当前Browser实例
	 *&#x2F;
	size: function(width, height){
		var self = this,
			windowHandle = self.windowHandle;
		if(width === undefined){
			&#x2F;&#x2F;返回首个窗口的大小
			return self.doCommand(&#x27;getWindowSize&#x27;, {&#x27;pathValues&#x27;: {&#x27;windowHandle&#x27;: windowHandle}});
		}
		else if(width.width !== undefined){
			height = width.height;
			width = width.width;
		}
		self.doCommand(&#x27;setWindowSize&#x27;, {
			&#x27;pathValues&#x27;: {&#x27;windowHandle&#x27;: windowHandle},
			&#x27;width&#x27;: width,
			&#x27;height&#x27;: height
		});
		return self;
	},

	&#x2F;**
	 * 最大化当前窗口
	 * @method maximize
	 * @public
	 * @return {Browser}	当前Browser对象实例
	 *&#x2F;
	maximize: function(){
		var self = this;
		self.doCommand(&#x27;maximizeWindow&#x27;, {&#x27;pathValues&#x27;: {&#x27;windowHandle&#x27;: self.windowHandle}});
		return self;
	},

	&#x2F;**
	 * 返回或者设置当前窗口的坐标
	 * @method offset
	 * @public
	 * @param  {Number|Object} [x]  x坐标或者坐标对象({x,y})
	 * @param  {Number} [y] y坐标
	 * @return {Object|Browser}        如果无x坐标和y坐标参数，则返回当前坐标对象，否则返回当前Browser实例
	 *&#x2F;
	offset: function(x, y){
		var self = this,
			windowHandle = self.windowHandle;
		if(x === undefined){
			&#x2F;&#x2F;返回首个窗口的大小
			return self.doCommand(&#x27;getWindowOffset&#x27;, {&#x27;pathValues&#x27;: {&#x27;windowHandle&#x27;: windowHandle}});
		}
		else if(x.x !== undefined){
			y = x.y;
			x = x.x;
		}
		self.doCommand(&#x27;setWindowOffset&#x27;, {
			&#x27;pathValues&#x27;: {&#x27;windowHandle&#x27;: windowHandle},
			&#x27;x&#x27;: x,
			&#x27;y&#x27;: y
		});
		return self;
	},

	&#x2F;**
	 * 关闭当前窗口
	 * @method close
	 * @public
	 * @return {Browser}	当前Browser对象实例
	 *&#x2F;
	close: function(){
		var self = this;
		self.doCommand(&#x27;closeWindow&#x27;);
		return self;
	},

	&#x2F;**
	 * 结束浏览器会话
	 * @method end
	 * @public
	 * @return {Browser}	当前Browser对象实例
	 *&#x2F;
	end: function(){
		var self = this;
		self.doCommand(&#x27;delSession&#x27;);
		return self;
	},

	&#x2F;**
	 * 设置操作超时时间
	 * &lt;p&gt;
	 * 注：script包括同步和异步两种代码
	 * &lt;&#x2F;p&gt;
	 * @method setTimeout
	 * @public
	 * @param  {String} type 操作类型(script|ascript|implicit|page load)
	 * @param  {Number} ms   超时时间
	 * @return {Browser}	当前Browser对象实例
	 *&#x2F;
	setTimeout: function(type, ms){
		var self = this;
		if(type === &#x27;ascript&#x27;){
			self.doCommand(&#x27;setAscriptTimeout&#x27;, {&#x27;ms&#x27;: ms});
		}
		else{
			self.doCommand(&#x27;setTimeouts&#x27;, {&#x27;type&#x27;: type, &#x27;ms&#x27;: ms});
		}
		return self;
	},

	&#x2F;**
	 * 打开或者返回当前URL
	 * @method url
	 * @public
	 * @param  {String} [url] 需要打开的URL网址，若省略此参数则返回当前浏览器URL
	 * @return {String|Browser}     若打开URL则返回当前Browser对象实例，否则返回URL地址
	 *&#x2F;
	url: function(url){
		var self = this;
		if(url){
			self.doCommand(&#x27;setUrl&#x27;, {&#x27;url&#x27;: url});
			return self;
		}
		else {
			return self.doCommand(&#x27;getUrl&#x27;);
		}
	},

	&#x2F;**
	 * 控制浏览器回到后一个URL
	 * @method forward
	 * @public
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	forward: function(){
		var self = this;
		self.doCommand(&#x27;setForward&#x27;);
		return self;
	},

	&#x2F;**
	 * 控制浏览器回到前一个URL
	 * @method back
	 * @public
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	back: function(){
		var self = this;
		self.doCommand(&#x27;setBack&#x27;);
		return self;
	},

	&#x2F;**
	 * 刷新当前页面
	 * @method refresh
	 * @public
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	refresh: function(){
		var self = this;
		self.doCommand(&#x27;setRefresh&#x27;);
		return self;
	},

	&#x2F;**
	 * 返回当前页面title
	 * @method title
	 * @public
	 * @return {String} 页面title
	 *&#x2F;
	title: function(){
		return this.doCommand(&#x27;getTitle&#x27;);
	},

	&#x2F;**
	 * 返回当前页面源代码
	 * @method source
	 * @public
	 * @return {String} 页面源代码
	 *&#x2F;
	source: function(){
		return this.doCommand(&#x27;getSource&#x27;);
	},

	&#x2F;**
	 * 返回当前页面下所有cookie
	 * @method getCookies
	 * @public
	 * @return {Array} cookie对象数组
	 *&#x2F;
	getCookies: function(){
		return this.doCommand(&#x27;getAllCookie&#x27;);
	},

	&#x2F;**
	 * 添加cookie到当前页面
	 * &lt;p&gt;
	 * 这里可以查看WebDriver官方定义的&lt;a href=&quot;http:&#x2F;&#x2F;code.google.com&#x2F;p&#x2F;selenium&#x2F;wiki&#x2F;JsonWireProtocol#Cookie_JSON_Object&quot; target=&quot;_blank&quot;&gt;cookie对象&lt;&#x2F;a&gt;
	 * &lt;&#x2F;p&gt;
	 * @method addCookie
	 * @public
	 * @param {Object} cookie cookie对象
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	addCookie: function(cookie){
		var self = this;
		self.doCommand(&#x27;setCookie&#x27;, {&#x27;cookie&#x27;: cookie});
		return self;
	},

	&#x2F;**
	 * 删除cookie
	 * @method delCookies
	 * @public
	 * @param  {String} name cookie name
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	delCookies: function(name){
		var self = this;
		if(name !== undefined){
			self.doCommand(&#x27;delCookie&#x27;, {&#x27;pathValues&#x27;: {&#x27;name&#x27;: name}});
		}
		else{
			self.doCommand(&#x27;delAllCookies&#x27;);
		}
		return self;
	},

	&#x2F;**
	 * 执行Javascript脚本
	 * @method exec
	 * @public
	 * @param  {String} script Javascript代码
	 * @param  {Array|Object} [args]   传递给脚本的参数，此参数可省略
	 * @param  {Boolean} bAsync 是否异步，如果是异步必需要调用callback返回，否则一直阻塞
	 * @return {Object}        Javascript脚本的返回值
	 *&#x2F;
	exec: function(script, args, bAsync){
		if(typeof args === &#x27;boolean&#x27;){
			bAsync = args;
			args = [];
		}
		args = args?args:[];
		if(Object.prototype.toString.apply(args) !== &#x27;[object Array]&#x27;){
			&#x2F;&#x2F;单参数模式
			args = [args];
		}
		var arg;
		for(var i in args){
			arg = args[i];
			if(arg instanceof Element){
				&#x2F;&#x2F;转换为原生Element对象
				args[i] = arg.toArray();
			}
		}
		var data = {&#x27;script&#x27;: script, args: args};
		return this.doCommand(bAsync === true?&#x27;executeAsync&#x27;:&#x27;execute&#x27;, data);
	},

	&#x2F;**
	 * 获取弹出窗口的文本(alert, confirm, prompt)
	 * @method getAlert
	 * @public
	 * @return {String} 弹出窗口的文本
	 *&#x2F;
	getAlert: function(){
		return this.doCommand(&#x27;getAlert&#x27;);
	},

	&#x2F;**
	 * 输入prompt中的值
	 * @method setAlert
	 * @public
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	setAlert: function(str){
		var self = this;
		self.doCommand(&#x27;setAlert&#x27;, {&#x27;text&#x27;: str});
		return self;
	},

	&#x2F;**
	 * 关闭弹出窗口
	 * @method closeAlert
	 * @public
	 * @param  {String} [btn] 点击哪个按钮关闭窗口：ok|cancel,默认cancel
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	closeAlert: function(btn){
		var self = this;
		self.doCommand(&#x2F;^ok$&#x2F;i.test(btn)?&#x27;acceptAlert&#x27;:&#x27;dismissAlert&#x27;);
		return self;
	},

	&#x2F;**
	 * 获取或保存当前网页截图
	 * &lt;p&gt;
	 * filePath为可选项，若有则保存到文件
	 * &lt;&#x2F;p&gt;
	 * @method getScreenshot
	 * @public
	 * @param  {String} [filePath] 保存截图的文件路径
	 * @return {String}          Base64格式的网页截图
	 *&#x2F;
	getScreenshot: function(filePath){
		var data = this.doCommand(&#x27;getScreenshot&#x27;);
		if(filePath){
			fs.writeFileSync(filePath, data, &quot;base64&quot;);
		}
		return data;
	},

	&#x2F;**
	 * 获取按键映射后的字符数组
	 * @method _getKeyArray
	 * @private
	 * @param  {String} str 原始字符串
	 * @return {Array}     经过映射后的字符数组
	 *&#x2F;
	_getKeyArray: function(str){
		str = str.replace(&#x2F;{(\w+)}&#x2F;g, function(all, name){
			var key = arrSpecKeys[name.toLowerCase()];
			return key?key:all;
		});
		return str.split(&#x27;&#x27;);
	},

	&#x2F;**
	 * 发送按键序列到当前焦点对象上
	 * @method sendKeys
	 * @public
	 * @param  {String} str 原始字符串
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	sendKeys: function(str){
		var self = this;
		self.doCommand(&#x27;sendKeys&#x27;, {&#x27;value&#x27;: self._getKeyArray(str)});
		return self;
	},

	&#x2F;**
	 * 在当前光标处触发单击事件
	 * @method click
	 * @public
	 * @param  {String} mouseBtn 鼠标按钮类型：left|middle|right
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	click: function(mouseBtn){
		var self = this, data = {};
		if(mouseBtn){
			var button = arrMouseButton[mouseBtn.toLowerCase()];
			if(button){
				data.button = button;
			}
		}
		self.doCommand(&#x27;click&#x27;, data);
		return self;
	},

	&#x2F;**
	 * 在当前光标处触发双击事件
	 * @method dblclick
	 * @public
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	dblclick: function(){
		var self = this;
		self.doCommand(&#x27;dblclick&#x27;);
		return self;
	},

	&#x2F;**
	 * 在当前光标处触发鼠标左键按下
	 * @method mousedown
	 * @public
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	mousedown: function(){
		var self = this;
		self.doCommand(&#x27;mousedown&#x27;);
		return self;
	},

	&#x2F;**
	 * 移动到指定对象中间或坐标点
	 * @method mousemove
	 * @public
	 * @param  {Number|Element|Object} x X坐标或Element对象或{x,y}
	 * @param  {Number} y y坐标
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	mousemove: function(x, y){
		var self = this, data = {};
		if(x instanceof Element){
			data.element = x.toArray().ELEMENT;
		}
		else if(x.x &amp;&amp; x.y){
			data.xoffset = x.x;
			data.yoffset = x.y;
		}
		else{
			data.xoffset = x;
			data.yoffset = y;
		}
		if(data.element === undefined){
			data.xoffset = Math.round(data.xoffset);
			data.yoffset = Math.round(data.yoffset);
		}
		self.doCommand(&#x27;mousemove&#x27;, data);
		return self;
	},

	&#x2F;**
	 * 在当前光标处触发鼠标左键按起
	 * @method mouseup
	 * @public
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	mouseup: function(){
		var self = this;
		self.doCommand(&#x27;mouseup&#x27;);
		return self;
	},

	&#x2F;**
	 * 拖放
	 * @method dragDrop
	 * @public
	 * @param  {Element|Object} from 源对象或源坐标({x,y})
	 * @param  {Element|Object} to   目标对象或目标坐标({x,y})
	 * @return {Browser} 当前Browser对象实例
	 *&#x2F;
	dragDrop: function(from, to){
		var self = this;
		self.mousemove(from).mousedown().mousemove(to).mouseup();
		return self;
	},

	&#x2F;**
	 * 等待对象出现或消失
	 * @method waitFor
	 * @public
	 * @param  {String} [using]  对象选择类型，留空默认为：css selector(class name|css selector|id|name|link text|partial link text|tag name|xpath)
	 * @param  {String} value  对象选择值
	 * @param  {Boolean} [targetExist] 测试目标是对象存在或不存在
	 * @param  {Number} [timeout] 等待超时时间，单位毫秒，默认30000毫秒
	 * @return {Element|Object} 等待的目标如果存在，则返回Element对象，如果不存在或者超时则返回错误对象
	 *&#x2F;
	waitFor: function(using, value, targetExist, timeout){
		var self = this,
			fiber = Fiber.current,
			ret, bExist;
		if(typeof value !== &#x27;string&#x27;){
			&#x2F;&#x2F;默认css选择器
			targetExist = value;
			value = using;
			using = &#x27;css selector&#x27;;
		}
		if(typeof targetExist === &#x27;number&#x27;){
			timeout = targetExist;
			targetExist = true;
		}
		if(targetExist === undefined){
			targetExist = true;
		}
		if(timeout === undefined){
			timeout = 30000;
		}
		var _timer1, _timer2;
		function waitElement(){
			self.doCommand(&#x27;getElement&#x27;, {&#x27;using&#x27;: using,&#x27;value&#x27;: value}, function(result){
				bExist  = self.isOk(result);
				if(bExist === targetExist){
					clearTimeout(_timer2);
					ret = result;
					fiber.run();
				}
				else if(_timer1 !== null){
					_timer1 = setTimeout(waitElement, 500);
				}
			});
		}
		_timer1 = setTimeout(waitElement, 1);
		_timer2 = setTimeout(function(){
			clearTimeout(_timer1);
			_timer1 = null;
			var errorMessage = &#x27;waitFor timeout: &#x27; + using + &#x27; , &#x27; + value;
			&#x2F;&#x2F;超时
			ret = {
				&#x27;status&#x27;:-1,
				&#x27;errorType&#x27;: &#x27;waitForTimeout&#x27;,
				&#x27;errorMessage&#x27;: errorMessage
			};
			self.log(&#x27;ERROR&#x27;, errorMessage);
			fiber.run();
		}, timeout);
		Fiber.yield();
		return bExist === true ? self.element(&#x27;element&#x27;, ret.ELEMENT) : ret;
	},

	&#x2F;**
	 * 返回Element对象实例
	 * &lt;p&gt;
	 * 此方法不建议直接调用，建议使用run函数的第二个参数$符，例如:
	 * &lt;pre&gt;
	 * wd.run(function(browser, $){
	 * 	$(&#x27;#id&#x27;).val(&#x27;test&#x27;);
	 * })
	 * &lt;&#x2F;pre&gt;
	 * &lt;&#x2F;p&gt;
	 * @method element
	 * @public
	 * @param  {String} [using] 对象选择类型，留空默认为：css selector(class name|css selector|id|name|link text|partial link text|tag name|xpath)
	 * @param  {String} [value] 对象选择值，留空返回当前焦点所在对象
	 * @return {Element}       Element的实例对象，如果对象不存在，返回原始消息
	 *&#x2F;
	element: function(using, value){
		var self = this;
		var element = new Element(self, using, value);
		return self.isError(element._id) ? element._id : element;
	}

}

module.exports = Browser;
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
